<!-- templates/data_access.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Access - Healthcare Cost Analysis</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for dark theme and typography - consistent with index.html */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text color */
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background-color: #2d3748; /* Slightly lighter dark for cards */
            border-radius: 0.5rem; /* Rounded corners */
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #4a5568; /* Subtle border */
        }
        .input-group label {
            color: #cbd5e0; /* Slightly darker label text */
            margin-bottom: 0.5rem;
            display: block;
            font-weight: 500;
        }
        .input-group input[type="file"] {
            background-color: #4a5568;
            border: 1px solid #6b7280;
            color: #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .input-group input[type="file"]::file-selector-button {
            background-color: #3182ce;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            margin-right: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .input-group input[type="file"]::file-selector-button:hover {
            background-color: #2c5282;
        }
        .btn-primary {
            background-color: #3182ce; /* Blue button */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #2c5282;
        }
        .nav-link {
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            color: #a0aec0; /* Lighter gray for inactive links */
            font-weight: 500;
        }
        .nav-link:hover {
            background-color: #4a5568; /* Darker hover background */
            color: #e2e8f0;
        }
        .nav-link.active {
            background-color: #3182ce; /* Teal/Blue for active link */
            color: white;
        }
        .flash-message {
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        .flash-message.success {
            background-color: #2f855a; /* Green for success */
            color: white;
        }
        .flash-message.error {
            background-color: #c53030; /* Red for error */
            color: white;
        }
        .flash-message.warning {
            background-color: #d69e2e; /* Orange for warning */
            color: white;
        }
        .flash-message.info {
            background-color: #3182ce; /* Blue for info */
            color: white;
        }
    </style>
</head>
<body class="antialiased">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gray-800 shadow-md py-4">
            <div class="container flex justify-between items-center">
                <h1 class="text-3xl font-bold text-teal-400">Healthcare Cost Analysis</h1>
                <nav>
                    <ul class="flex space-x-4">
                        <li><a href="{{ url_for('data_access') }}" class="nav-link {% if current_page == 'data_access' %}active{% endif %}">Data Access</a></li>
                        <li><a href="{{ url_for('data_engineering') }}" class="nav-link {% if current_page == 'data_engineering' %}active{% endif %}">Data Engineering</a></li>
                        <li><a href="{{ url_for('machine_learning') }}" class="nav-link {% if current_page == 'machine_learning' %}active{% endif %}">Machine Learning</a></li>
                        <li><a href="{{ url_for('h2o_ai_integration') }}" class="nav-link {% if current_page == 'h2o_ai_integration' %}active{% endif %}">Run H2O.ai</a></li>
                        <li><a href="{{ url_for('index') }}" class="nav-link {% if current_page == 'analysis_report' %}active{% endif %}">Analysis Report</a></li>
                        <li><a href="{{ url_for('job_status_review') }}" class="nav-link {% if current_page == 'job_status_review' %}active{% endif %}">Job Status Review</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow container py-8">
            <h2 class="text-2xl font-semibold text-teal-300 mb-6">Data Access</h2>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="mb-4">
                        {% for category, message in messages %}
                            <div class="flash-message {{ category }}">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- File Upload Card -->
                <div class="card">
                    <h3 class="text-xl font-semibold text-white mb-4">Upload Data File</h3>
                    <p class="text-gray-400 mb-6">Upload your healthcare cost data in CSV, XLS, XLSX, or TXT format.</p>

                    <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" class="space-y-6">
                        <div class="input-group">
                            <label for="data-file" class="block text-sm font-medium text-gray-300 mb-2">Select File:</label>
                            <input type="file" id="data-file" name="file" accept=".csv, .xls, .xlsx, .txt" class="block w-full text-sm text-gray-400
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-md file:border-0
                                file:text-sm file:font-semibold
                                file:bg-blue-500 file:text-white
                                hover:file:bg-blue-600">
                        </div>
                        <button type="submit" class="btn-primary">Upload and Load Data</button>
                    </form>

                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-white mb-3">Expected Data Format:</h4>
                        <p class="text-gray-400 mb-2">Your data file (CSV, XLS, XLSX, TXT) must contain the following columns with these exact names:</p>
                        <ul class="list-disc list-inside text-gray-400 space-y-1">
                            {% for col in required_columns %}
                                <li><code>{{ col }}</code></li>
                            {% endfor %}
                            <li>**Note:** If 'Medical Classification' or 'Reimbursement Rate' are missing, the system will attempt to infer/calculate them.</li>
                        </ul>
                        <p class="text-gray-400 mt-4">Download a <a href="#" onclick="downloadSampleCSV()" class="text-teal-400 hover:underline">sample CSV file</a> to guide your data preparation.</p>
                    </div>
                </div>

                <!-- DB Access Card (Placeholder) -->
                <div class="card">
                    <h3 class="text-xl font-semibold text-white mb-4">Database Access</h3>
                    <p class="text-gray-400 mb-6">Connect directly to your database to fetch healthcare cost data.</p>

                    <div class="space-y-6">
                        <div class="input-group">
                            <label for="db-type" class="block text-sm font-medium text-gray-300 mb-2">Database Type:</label>
                            <select id="db-type" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm" disabled>
                                <option>MongoDB (Coming Soon)</option>
                                <option>Oracle (Coming Soon)</option>
                                <option>SQL Server (Coming Soon)</option>
                                <option>PostgreSQL (Coming Soon)</option>
                                <option>MySQL (Coming Soon)</option>
                                <option>MariaDB (Coming Soon)</option>
                            </select>
                        </div>
                        <p class="text-gray-500 text-sm">Database connection functionality will be implemented in future updates.</p>
                        <button type="button" class="btn-primary opacity-50 cursor-not-allowed" disabled>Connect to Database</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 py-4 mt-8">
            <div class="container text-center text-gray-500 text-sm">
                &copy; 2025 Healthcare Cost Analysis. All rights reserved.
            </div>
        </footer>
    </div>

    <script>
        // Function to download the sample CSV
        function downloadSampleCSV() {
            // The content of the CSV file, copied from the provided healthcare_data_sample.csv immersive
            const csvContent = `DRG Code,Medical Definition,Total Discharges,Provider Name,Provider State,Hospital Referral Region,Medical Classification,Average Covered Charges,Average Total Payments,Reimbursement Rate
039 - EXTRACRANIAL PROCEDURES W CC,EXTRACRANIAL PROCEDURES,100,Hospital A,NY,New York City,Circulatory System,30000.00,15000.00,0.50
039 - EXTRACRANIAL PROCEDURES W CC,EXTRACRANIAL PROCEDURES,50,Hospital B,CA,Los Angeles,Circulatory System,28000.00,14500.00,0.52
001 - HEART TRANSPLANT OR IMPLANT OF HEART ASSIST SYSTEM W MCC,HEART TRANSPLANT,10,Hospital C,TX,Houston,Circulatory System,500000.00,250000.00,0.50
291 - HEART FAILURE & SHOCK W MCC,HEART FAILURE,250,Hospital A,NY,New York City,Circulatory System,15000.00,7000.00,0.47
291 - HEART FAILURE & SHOCK W MCC,HEART FAILURE,180,Hospital B,CA,Los Angeles,Circulatory System,14000.00,6500.00,0.46
897 - ALCOHOL/DRUG ABUSE OR DEPENDENCE W CC,ALCOHOL/DRUG ABUSE,80,Rehab Center D,FL,Miami,Alcohol and Drug Use,12000.00,6000.00,0.50
897 - ALCOHOL/DRUG ABUSE OR DEPENDENCE W CC,ALCOHOL/DRUG ABUSE,40,Rehab Center E,GA,Atlanta,Alcohol and Drug Use,11000.00,5800.00,0.53
302 - KIDNEY TRANSPLANT,KIDNEY TRANSPLANT,5,Hospital F,IL,Chicago,Blood Diseases,400000.00,200000.00,0.50
286 - ACUTE MYOCARDIAL INFARCTION, DISCHARGED ALIVE W MCC,ACUTE MYOCARDIAL INFARCTION,120,Hospital G,WA,Seattle,Circulatory System,25000.00,12000.00,0.48
287 - ACUTE MYOCARDIAL INFARCTION, DISCHARGED ALIVE W CC,ACUTE MYOCARDIAL INFARCTION,90,Hospital H,OR,Portland,Circulatory System,22000.00,11000.00,0.50
880 - ACUTE LEUKEMIA WITHOUT MCC,ACUTE LEUKEMIA,30,Hospital I,AZ,Phoenix,Blood Diseases,18000.00,9000.00,0.50
881 - CHRONIC LEUKEMIA WITHOUT MCC,CHRONIC LEUKEMIA,25,Hospital J,NV,Las Vegas,Blood Diseases,16000.00,8000.00,0.50
917 - POISONING & TOXIC EFFECTS OF DRUGS W MCC,POISONING & TOXIC EFFECTS OF DRUGS,60,Hospital K,CO,Denver,Alcohol and Drug Use,10000.00,5000.00,0.50
918 - POISONING & TOXIC EFFECTS OF DRUGS W CC,POISONING & TOXIC EFFECTS OF DRUGS,55,Hospital L,UT,Salt Lake City,Alcohol and Drug Use,9500.00,4800.00,0.51
190 - CHRONIC OBSTRUCTIVE PULMONARY DISEASE W MCC,COPD,70,Hospital M,ID,Boise,Respiratory System,13000.00,6500.00,0.50
191 - CHRONIC OBSTRUCTIVE PULMONARY DISEASE W CC,COPD,200,Hospital N,MT,Billings,Respiratory System,12500.00,6000.00,0.48
640 - MISCELLANEOUS DISORDERS OF NUTRITION, METABOLISM, FLUIDS & ELECTROLYTES W MCC,METABOLIC DISORDERS,90,Hospital O,WY,Cheyenne,Endocrine, Nutritional & Metabolic,11500.00,5900.00,0.51
641 - MISCELLANEOUS DISORDERS OF NUTRITION, METABOLISM, FLUIDS & ELECTROLYTES W CC,METABOLIC DISORDERS,15,Hospital P,ND,Fargo,Endocrine, Nutritional & Metabolic,10500.00,5000.00,0.48
470 - MAJOR JOINT REPLACEMENT OR REATTACHMENT OF LOWER EXTREMITY W MCC,JOINT REPLACEMENT,110,Hospital Q,SD,Sioux Falls,Musculoskeletal System,30000.00,15000.00,0.50
471 - MAJOR JOINT REPLACEMENT OR REATTACHMENT OF LOWER EXTREMITY W CC,JOINT REPLACEMENT,40,Hospital R,NE,Omaha,Musculoskeletal System,28000.00,14000.00,0.50
`;
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) { // feature detection
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'healthcare_data_sample.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    </script>
</body>
</html>
