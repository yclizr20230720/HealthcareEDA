<!-- templates/index.html (Frontend) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Cost Analysis Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Plotly.js CDN - Updated to a more recent version -->
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <style>
        /* Custom styles for dark theme and typography */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text color */
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background-color: #2d3748; /* Slightly lighter dark for cards */
            border-radius: 0.5rem; /* Rounded corners */
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #4a5568; /* Subtle border */
        }
        .input-group label {
            color: #cbd5e0; /* Slightly darker label text */
            margin-bottom: 0.5rem;
            display: block;
            font-weight: 500;
        }
        .input-group select, .input-group input[type="radio"] + label,
        .input-group input[type="range"] {
            background-color: #4a5568; /* Darker input background */
            border: 1px solid #6b7280;
            color: #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.5rem 1rem;
            font-size: 0.9rem; /* Default font size for inputs */
            cursor: pointer;
        }
        /* Specific adjustment for radio button labels within chart controls for compactness */
        .chart-controls .input-group input[type="radio"] + label {
            font-size: 0.75rem; /* Smaller font size for these specific radio buttons */
            padding: 0.375rem 0.75rem; /* Smaller padding */
        }

        .input-group select:focus, .input-group input[type="radio"] + label:focus-within,
        .input-group input[type="range"]:focus {
            outline: none;
            border-color: #3182ce; /* Blue accent on focus */
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.5);
        }
        .input-group input[type="radio"]:checked + label {
            background-color: #3182ce; /* Blue accent for selected radio */
            border-color: #3182ce;
            color: white;
        }
        .nav-link {
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            color: #a0aec0; /* Lighter gray for inactive links */
            font-weight: 500;
        }
        .nav-link:hover {
            background-color: #4a5568; /* Darker hover background */
            color: #e2e8f0;
        }
        .nav-link.active {
            background-color: #3182ce; /* Teal/Blue for active link */
            color: white;
        }
        /* Plotly specific overrides for dark theme */
        .js-plotly-plot .plotly .modebar-btn {
            background-color: #2d3748 !important; /* Modebar background */
            color: #e2e8f0 !important; /* Modebar icon color */
            border: 1px solid #4a5568 !important;
        }
        .js-plotly-plot .plotly .modebar-btn:hover {
            background-color: #4a5568 !important;
        }
        .js-plotly-plot .plotly .g-gtitle {
            fill: #e2e8f0 !important; /* Plot title color */
        }
        .js-plotly-plot .plotly .xtick text, .js-plotly-plot .plotly .ytick text {
            fill: #a0aec0 !important; /* Axis tick labels */
        }
        .js-plotly-plot .plotly .axis-title {
            fill: #e2e8f0 !important; /* Axis title */
        }
        .js-plotly-plot .plotly .legend .item text {
            fill: #e2e8f0 !important; /* Legend text */
        }
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        /* Range slider track and thumb styling */
        input[type="range"] {
            -webkit-appearance: none; /* Override default appearance */
            width: 100%;
            height: 8px;
            background: #4a5568;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 5px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3182ce;
            cursor: pointer;
            border: 2px solid #e2e8f0;
            box-shadow: 0 0 0 2px rgba(49, 130, 206, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3182ce;
            cursor: pointer;
            border: 2px solid #e2e8f0;
            box-shadow: 0 0 0 2px rgba(49, 130, 206, 0.5);
        }
        .flash-message {
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        .flash-message.success {
            background-color: #2f855a; /* Green for success */
            color: white;
        }
        .flash-message.error {
            background-color: #c53030; /* Red for error */
            color: white;
        }
        .flash-message.warning {
            background-color: #d69e2e; /* Orange for warning */
            color: white;
        }
        .flash-message.info {
            background-color: #3182ce; /* Blue for info */
            color: white;
        }
    </style>
</head>
<body class="antialiased">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gray-800 shadow-md py-4">
            <div class="container flex justify-between items-center">
                <h1 class="text-3xl font-bold text-teal-400">Healthcare Cost Analysis</h1>
                <nav>
                    <ul class="flex space-x-4">
                        <li><a href="{{ url_for('data_access') }}" class="nav-link {% if current_page == 'data_access' %}active{% endif %}">Data Access</a></li>
                        <li><a href="{{ url_for('data_engineering') }}" class="nav-link {% if current_page == 'data_engineering' %}active{% endif %}">Data Engineering</a></li>
                        <li><a href="{{ url_for('machine_learning') }}" class="nav-link {% if current_page == 'machine_learning' %}active{% endif %}">Machine Learning</a></li>
                        <li><a href="{{ url_for('h2o_ai_integration') }}" class="nav-link {% if current_page == 'h2o_ai_integration' %}active{% endif %}">Run H2O.ai</a></li>
                        <li><a href="{{ url_for('index') }}" class="nav-link {% if current_page == 'analysis_report' %}active{% endif %}">Analysis Report</a></li>
                        <li><a href="{{ url_for('job_status_review') }}" class="nav-link {% if current_page == 'job_status_review' %}active{% endif %}">Job Status Review</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow container py-8">
            <h2 class="text-2xl font-semibold text-teal-300 mb-6">Analysis Report</h2>

            <!-- Data Source Indicator -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="mb-4">
                        {% for category, message in messages %}
                            <div class="flash-message {{ category }}">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            {% if uploaded_data_exists %}
                <div class="flash-message info">
                    Currently displaying data from your uploaded file.
                </div>
            {% else %}
                <div class="flash-message info">
                    Currently displaying sample mock data. Please upload your own data via the "Data Access" page.
                </div>
            {% endif %}

            <!-- Global Filters Section -->
            <div class="card mb-8">
                <h3 class="text-xl font-semibold text-white mb-4">Global Filters</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <!-- Medical Classification -->
                    <div class="input-group">
                        <label for="filter-classification" class="block text-sm font-medium text-gray-300 mb-2">Medical Classification:</label>
                        <select id="filter-classification" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                            <option value="All">All</option>
                            {% for cls in classifications %}
                                {% if cls != 'All' %}
                                    <option value="{{ cls }}">{{ cls }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Medical Definition -->
                    <div class="input-group">
                        <label for="filter-definition" class="block text-sm font-medium text-gray-300 mb-2">Medical Definition:</label>
                        <select id="filter-definition" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                            <option value="All">All</option>
                            {% for def in definitions %}
                                {% if def != 'All' %}
                                    <option value="{{ def }}">{{ def }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>

                    <!-- DRG Code -->
                    <div class="input-group">
                        <label for="filter-drg-code" class="block text-sm font-medium text-gray-300 mb-2">DRG Code:</label>
                        <select id="filter-drg-code" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                            <option value="All">All</option>
                            {% for drg in drg_codes %}
                                {% if drg != 'All' %}
                                    <option value="{{ drg }}">{{ drg }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Provider State -->
                    <div class="input-group">
                        <label for="filter-provider-state" class="block text-sm font-medium text-gray-300 mb-2">Provider State:</label>
                        <select id="filter-provider-state" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                            <option value="All States">All States</option>
                            {% for state in provider_states %}
                                {% if state != 'All States' %}
                                    <option value="{{ state }}">{{ state }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Hospital Referral Region -->
                    <div class="input-group">
                        <label for="filter-hospital-region" class="block text-sm font-medium text-gray-300 mb-2">Hospital Referral Region:</label>
                        <select id="filter-hospital-region" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                            <option value="All">All</option>
                            {% for region in hospital_regions %}
                                {% if region != 'All' %}
                                    <option value="{{ region }}">{{ region }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Range Sliders -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Reimbursement Rate -->
                    <div class="input-group">
                        <label for="filter-reimbursement-rate" class="block text-sm font-medium text-gray-300 mb-2">Reimbursement Rate: <span id="reimbursement-rate-display"></span></label>
                        <input type="range" id="filter-reimbursement-rate-min" min="{{ min_reimbursement }}" max="{{ max_reimbursement }}" step="0.01" value="{{ min_reimbursement }}" class="w-full">
                        <input type="range" id="filter-reimbursement-rate-max" min="{{ min_reimbursement }}" max="{{ max_reimbursement }}" step="0.01" value="{{ max_reimbursement }}" class="w-full">
                    </div>

                    <!-- Average Covered Charges -->
                    <div class="input-group">
                        <label for="filter-charges" class="block text-sm font-medium text-gray-300 mb-2">Average Covered Charges: <span id="charges-display"></span></label>
                        <input type="range" id="filter-charges-min" min="{{ min_charges }}" max="{{ max_charges }}" step="1" value="{{ min_charges }}" class="w-full">
                        <input type="range" id="filter-charges-max" min="{{ min_charges }}" max="{{ max_charges }}" step="1" value="{{ max_charges }}" class="w-full">
                    </div>

                    <!-- Total Discharges -->
                    <div class="input-group">
                        <label for="filter-discharges" class="block text-sm font-medium text-gray-300 mb-2">Total Discharges: <span id="discharges-display"></span></label>
                        <input type="range" id="filter-discharges-min" min="{{ min_discharges }}" max="{{ max_discharges }}" step="1" value="{{ min_discharges }}" class="w-full">
                        <input type="range" id="filter-discharges-max" min="{{ min_discharges }}" max="{{ max_discharges }}" step="1" value="{{ max_discharges }}" class="w-full">
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Treemap of Medical Definitions -->
                <div class="card">
                    <h3 class="text-xl font-semibold text-white mb-2">Total Discharges by Medical Definition</h3>
                    <p class="text-gray-400 mb-4">Treemap visualization showing total discharges grouped by medical definition or DRG code.</p>
                    <div class="flex flex-wrap gap-4 mb-4 chart-controls">
                        <div class="input-group flex-1 min-w-[150px]">
                            <label for="treemap-classification-filter" class="block text-sm font-medium text-gray-300 mb-2">Classification:</label>
                            <select id="treemap-classification-filter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                                <option value="All">All</option>
                                {% for cls in classifications %}
                                    {% if cls != 'All' %}
                                        <option value="{{ cls }}">{{ cls }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="input-group flex-1 min-w-[150px]">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Group By:</label>
                            <div class="mt-1 flex space-x-2"> <!-- Adjusted space-x for compactness -->
                                <div>
                                    <input type="radio" id="group-by-definition" name="group-by-treemap" value="Definition" class="hidden" checked>
                                    <label for="group-by-definition" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Definition</label>
                                </div>
                                <div>
                                    <input type="radio" id="group-by-drg" name="group-by-treemap" value="DRG" class="hidden">
                                    <label for="group-by-drg" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">DRG</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="treemap-chart" class="w-full h-[400px] bg-gray-700 rounded-md"></div>
                </div>

                <!-- Reimbursement Rate by Medical Classification (Bar Chart) -->
                <div class="card">
                    <h3 class="text-xl font-semibold text-white mb-2">Reimbursement Rate by Medical Classification</h3>
                    <p class="text-gray-400 mb-4">Bar chart showing reimbursement rates, filterable by definition and sortable.</p>
                    <div class="flex flex-wrap gap-4 mb-4 chart-controls">
                        <div class="input-group flex-1 min-w-[180px]">
                            <label for="bar-chart-definition" class="block text-sm font-medium text-gray-300 mb-2">Select Definition:</label>
                            <select id="bar-chart-definition" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                                <option value="All">All Definitions</option>
                                {% for def in definitions %}
                                    {% if def != 'All' %}
                                        <option value="{{ def }}">{{ def }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="input-group flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Sort By:</label>
                            <div class="mt-1 grid grid-cols-2 gap-2">
                                <div>
                                    <input type="radio" id="sort-reimbursement" name="bar-chart-sort" value="highest_to_lowest_reimbursement" class="hidden" checked>
                                    <label for="sort-reimbursement" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Highest Reimbursement</label>
                                </div>
                                <div>
                                    <input type="radio" id="sort-alphabetical" name="bar-chart-sort" value="alphabetical" class="hidden">
                                    <label for="sort-alphabetical" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Alphabetical</label>
                                </div>
                                <div>
                                    <input type="radio" id="sort-charges" name="bar-chart-sort" value="highest_to_lowest_charges" class="hidden">
                                    <label for="sort-charges" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Highest Charges</label>
                                </div>
                                <div>
                                    <input type="radio" id="sort-payments" name="bar-chart-sort" value="highest_to_lowest_payments" class="hidden">
                                    <label for="sort-payments" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Highest Payments</label>
                                </div>
                                <div>
                                    <input type="radio" id="sort-gap" name="bar-chart-sort" value="largest_gap" class="hidden">
                                    <label for="sort-gap" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Largest Gap</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="bar-chart" class="w-full h-[400px] bg-gray-700 rounded-md"></div>
                </div>

                <!-- Geographic Variation in Average Covered Charges (Choropleth Map) -->
                <div class="card lg:col-span-2">
                    <h3 class="text-xl font-semibold text-white mb-2">Geographic Variation in Average Covered Charges</h3>
                    <p class="text-gray-400 mb-4">Choropleth map showing average covered charges across states, filterable by medical classification and definition.</p>
                    <div class="flex flex-wrap gap-4 mb-4 chart-controls">
                        <div class="input-group flex-1 min-w-[200px]">
                            <label for="choropleth-classification" class="block text-sm font-medium text-gray-300 mb-2">Medical Classification:</label>
                            <select id="choropleth-classification" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                                <option value="All">All Classifications</option>
                                {% for cls in classifications %}
                                    {% if cls != 'All' %}
                                        <option value="{{ cls }}">{{ cls }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="input-group flex-1 min-w-[200px]">
                            <label for="choropleth-definition" class="block text-sm font-medium text-gray-300 mb-2">Medical Definition:</label>
                            <select id="choropleth-definition" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                                <option value="All">All Definitions</option>
                                {% for def in definitions %}
                                    {% if def != 'All' %}
                                        <option value="{{ def }}">{{ def }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div id="choropleth-chart" class="w-full h-[500px] bg-gray-700 rounded-md"></div>
                </div>

                <!-- Average Total Payments vs. Average Covered Charges (Scatter Plot) -->
                <div class="card">
                    <h3 class="text-xl font-semibold text-white mb-2">Average Total Payments vs. Average Covered Charges</h3>
                    <p class="text-gray-400 mb-4">Scatter plot showing relationship between payments and charges, colorable by classification.</p>
                    <div class="flex flex-wrap gap-4 mb-4 chart-controls">
                        <div class="input-group flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Color By Classification:</label>
                            <div class="mt-1 flex space-x-2"> <!-- Adjusted space-x for compactness -->
                                <div>
                                    <input type="radio" id="color-by-all" name="scatter-color-by" value="All" class="hidden" checked>
                                    <label for="color-by-all" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">All</label>
                                </div>
                                <div>
                                    <input type="radio" id="color-by-circulatory" name="scatter-color-by" value="Circulatory System" class="hidden">
                                    <label for="color-by-circulatory" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Circulatory System</label>
                                </div>
                                <div>
                                    <input type="radio" id="color-by-blood" name="scatter-color-by" value="Blood Diseases" class="hidden">
                                    <label for="color-by-blood" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Blood Diseases</label>
                                </div>
                                <div>
                                    <input type="radio" id="color-by-alcohol" name="scatter-color-by" value="Alcohol and Drug Use" class="hidden">
                                    <label for="color-by-alcohol" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Alcohol and Drug Use</label>
                                </div>
                            </div>
                        </div>
                        <div class="input-group flex-1 min-w-[150px]">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Show Regression Line:</label>
                            <label for="show-regression" class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="show-regression" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                <span class="ml-3 text-sm font-medium text-gray-300">Toggle</span>
                            </label>
                        </div>
                    </div>
                    <div id="scatter-chart" class="w-full h-[400px] bg-gray-700 rounded-md"></div>
                </div>

                <!-- Total Discharges by Provider (Treemap) -->
                <div class="card">
                    <h3 class="text-xl font-semibold text-white mb-2">Total Discharges by Provider</h3>
                    <p class="text-gray-400 mb-4">Treemap showing total discharges by provider, filterable by state and top N.</p>
                    <div class="flex flex-wrap gap-4 mb-4 chart-controls">
                        <div class="input-group flex-1 min-w-[180px]">
                            <label for="provider-treemap-state" class="block text-sm font-medium text-gray-300 mb-2">Filter by State:</label>
                            <select id="provider-treemap-state" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                                <option value="All States">All States</option>
                                {% for state in provider_states %}
                                    {% if state != 'All States' %}
                                        <option value="{{ state }}">{{ state }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="input-group flex-1 min-w-[150px]">
                            <label for="top-n-providers" class="block text-sm font-medium text-gray-300 mb-2">Limit to Top N Providers: <span id="top-n-display">10</span></label>
                            <input type="range" id="top-n-providers" min="10" max="50" step="10" value="10" class="w-full">
                        </div>
                    </div>
                    <div id="provider-treemap-chart" class="w-full h-[400px] bg-gray-700 rounded-md"></div>
                </div>

                <!-- Distribution of Reimbursement Rates (Histogram) -->
                <div class="card">
                    <h3 class="text-xl font-semibold text-white mb-2">Distribution of Reimbursement Rates</h3>
                    <p class="text-gray-400 mb-4">Histogram showing distribution of reimbursement rates, with adjustable bin width and segmentation.</p>
                    <div class="flex flex-wrap gap-4 mb-4 chart-controls">
                        <div class="input-group flex-1 min-w-[150px]">
                            <label for="bin-width-slider" class="block text-sm font-medium text-gray-300 mb-2">Bin Width: <span id="bin-width-display">0.1</span></label>
                            <input type="range" id="bin-width-slider" min="0.05" max="0.2" step="0.05" value="0.1" class="w-full">
                        </div>
                        <div class="input-group flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Segment By Classification:</label>
                            <div class="mt-1 flex space-x-2"> <!-- Adjusted space-x for compactness -->
                                <div>
                                    <input type="radio" id="segment-by-all" name="histogram-segment-by" value="All" class="hidden" checked>
                                    <label for="segment-by-all" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">All</label>
                                </div>
                                <div>
                                    <input type="radio" id="segment-by-circulatory" name="histogram-segment-by" value="Circulatory System" class="hidden">
                                    <label for="segment-by-circulatory" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Circulatory System</label>
                                </div>
                                <div>
                                    <input type="radio" id="segment-by-blood" name="histogram-segment-by" value="Blood Diseases" class="hidden">
                                    <label for="segment-by-blood" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Blood Diseases</label>
                                </div>
                                <div>
                                    <input type="radio" id="segment-by-alcohol" name="histogram-segment-by" value="Alcohol and Drug Use" class="hidden">
                                    <label for="segment-by-alcohol" class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium transition-colors duration-200 ease-in-out">Alcohol and Drug Use</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="histogram-chart" class="w-full h-[400px] bg-gray-700 rounded-md"></div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 py-4 mt-8">
            <div class="container text-center text-gray-500 text-sm">
                &copy; 2025 Healthcare Cost Analysis. All rights reserved.
            </div>
        </footer>
    </div>

    <script>
        // Global filter elements
        const filterClassification = document.getElementById('filter-classification');
        const filterDefinition = document.getElementById('filter-definition');
        const filterDrgCode = document.getElementById('filter-drg-code');
        const filterProviderState = document.getElementById('filter-provider-state');
        const filterHospitalRegion = document.getElementById('filter-hospital-region');

        const filterReimbursementRateMin = document.getElementById('filter-reimbursement-rate-min');
        const filterReimbursementRateMax = document.getElementById('filter-reimbursement-rate-max');
        const reimbursementRateDisplay = document.getElementById('reimbursement-rate-display');

        const filterChargesMin = document.getElementById('filter-charges-min');
        const filterChargesMax = document.getElementById('filter-charges-max');
        const chargesDisplay = document.getElementById('charges-display');

        const filterDischargesMin = document.getElementById('filter-discharges-min');
        const filterDischargesMax = document.getElementById('filter-discharges-max');
        const dischargesDisplay = document.getElementById('discharges-display');

        // Chart-specific elements
        // Treemap (Medical Definition)
        const treemapClassificationFilter = document.getElementById('treemap-classification-filter');
        const groupByTreemapRadios = document.querySelectorAll('input[name="group-by-treemap"]');
        const treemapChartDiv = document.getElementById('treemap-chart');

        // Bar Chart (Reimbursement Rate)
        const barChartDefinitionFilter = document.getElementById('bar-chart-definition');
        const barChartSortRadios = document.querySelectorAll('input[name="bar-chart-sort"]');
        const barChartDiv = document.getElementById('bar-chart');

        // Choropleth Map
        const choroplethClassificationFilter = document.getElementById('choropleth-classification');
        const choroplethDefinitionFilter = document.getElementById('choropleth-definition');
        const choroplethChartDiv = document.getElementById('choropleth-chart');

        // Scatter Plot
        const scatterColorByRadios = document.querySelectorAll('input[name="scatter-color-by"]');
        const showRegressionToggle = document.getElementById('show-regression');
        const scatterChartDiv = document.getElementById('scatter-chart');

        // Treemap (Provider)
        const providerTreemapStateFilter = document.getElementById('provider-treemap-state');
        const topNProvidersSlider = document.getElementById('top-n-providers');
        const topNProvidersDisplay = document.getElementById('top-n-display');
        const providerTreemapChartDiv = document.getElementById('provider-treemap-chart');

        // Histogram
        const binWidthSlider = document.getElementById('bin-width-slider');
        const binWidthDisplay = document.getElementById('bin-width-display');
        const histogramSegmentByRadios = document.querySelectorAll('input[name="histogram-segment-by"]');
        const histogramChartDiv = document.getElementById('histogram-chart');


        // Helper function to get all current filter values
        function getAllFilters() {
            return {
                classification: filterClassification.value,
                definition: filterDefinition.value,
                drg_code: filterDrgCode.value,
                provider_state: filterProviderState.value,
                hospital_region: filterHospitalRegion.value,
                reimbursement_rate_min: filterReimbursementRateMin.value,
                reimbursement_rate_max: filterReimbursementRateMax.value,
                charges_min: filterChargesMin.value,
                charges_max: filterChargesMax.value,
                discharges_min: filterDischargesMin.value,
                discharges_max: filterDischargesMax.value,
            };
        }

        /**
         * Fetches data from a given API endpoint with current filters and updates the chart.
         * @param {string} endpoint - The API endpoint URL.
         * @param {Object} chartDiv - The HTML element to render the chart in.
         * @param {Function} renderFunction - The function to call to render the chart.
         * @param {Object} additionalParams - Any chart-specific parameters.
         */
        async function fetchDataAndRenderChart(endpoint, chartDiv, renderFunction, additionalParams = {}) {
            const globalFilters = getAllFilters();
            const params = new URLSearchParams({ ...globalFilters, ...additionalParams });
            try {
                const response = await fetch(`http://127.0.0.1:5000${endpoint}?${params.toString()}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                renderFunction(data, chartDiv, additionalParams);
            } catch (error) {
                console.error(`Error fetching data for ${endpoint}:`, error);
                chartDiv.innerHTML = `<p class="text-red-400 text-center p-4">Error loading chart data: ${error.message}. Please try again.</p>`;
            }
        }

        // --- Chart Rendering Functions ---

        /**
         * Renders the Treemap for Medical Definitions.
         */
        function renderMedicalDefinitionTreemap(data, chartDiv, params) {
            const labels = data.map(d => d.Label);
            const values = data.map(d => d['Total Discharges']);
            const groupBy = params.group_by_treemap || 'Definition';

            const chartTitle = `Total Discharges by ${groupBy === 'DRG' ? 'DRG Code' : 'Medical Definition'}`;

            const plotData = [{
                type: "treemap",
                labels: labels,
                parents: Array(labels.length).fill(""),
                values: values,
                marker: {
                    colorscale: 'Blues',
                    line: { width: 1, color: '#2d3748' }
                },
                textinfo: "label+value",
                hoverinfo: "text",
                hovertemplate: `<b>%{label}</b><br>Total Discharges: %{value}<extra></extra>`,
                pathbar: { visible: false },
            }];

            const layout = {
                title: {
                    text: chartTitle,
                    font: { color: '#e2e8f0', family: 'Inter, sans-serif' }
                },
                margin: { t: 50, l: 0, r: 0, b: 0 },
                paper_bgcolor: '#2d3748',
                plot_bgcolor: '#2d3748',
                font: { color: '#e2e8f0', family: 'Inter, sans-serif' },
                hoverlabel: { bgcolor: '#4a5568', font: { color: '#e2e8f0' } }
            };

            const config = { responsive: true, displayModeBar: true, modeBarButtonsToRemove: ['zoom2d', 'pan2d', 'select2d', 'lasso2d', 'autoscale', 'resetscale', 'hoverclosest', 'hovercompare', 'togglehover', 'sendDataToCloud', 'toggleSpikelines'] };
            Plotly.newPlot(chartDiv, plotData, layout, config);
        }

        /**
         * Renders the Bar Chart for Reimbursement Rate.
         */
        function renderReimbursementBarChart(data, chartDiv) {
            const plotData = [{
                x: data.map(d => d['Medical Definition']),
                y: data.map(d => d['AverageReimbursement']),
                type: 'bar',
                marker: { color: '#3182ce' }, // Blue color
                hovertemplate: `<b>%{x}</b><br>Avg. Reimbursement Rate: %{y:.2f}<br>Avg. Covered Charges: %{customdata[0]:$,.2f}<br>Avg. Total Payments: %{customdata[1]:$,.2f}<extra></extra>`,
                customdata: data.map(d => [d['AverageCoveredCharges'], d['AverageTotalPayments']]),
            }];

            const layout = {
                title: {
                    text: 'Reimbursement Rate by Medical Definition',
                    font: { color: '#e2e8f0', family: 'Inter, sans-serif' }
                },
                xaxis: {
                    title: 'Medical Definition',
                    tickangle: -45,
                    automargin: true,
                    showgrid: true,
                    gridcolor: '#4a5568',
                    linecolor: '#6b7280',
                    tickfont: { color: '#a0aec0' },
                    titlefont: { color: '#e2e8f0' }
                },
                yaxis: {
                    title: 'Average Reimbursement Rate',
                    showgrid: true,
                    gridcolor: '#4a5568',
                    linecolor: '#6b7280',
                    tickfont: { color: '#a0aec0' },
                    titlefont: { color: '#e2e8f0' },
                    range: [0, 1] // Reimbursement rate is typically between 0 and 1
                },
                paper_bgcolor: '#2d3748',
                plot_bgcolor: '#2d3748',
                font: { color: '#e2e8f0', family: 'Inter, sans-serif' },
                hoverlabel: { bgcolor: '#4a5568', font: { color: '#e2e8f0' } },
                bargap: 0.1
            };

            const config = { responsive: true, displayModeBar: true, modeBarButtonsToRemove: ['zoom2d', 'pan2d', 'select2d', 'lasso2d', 'autoscale', 'resetscale', 'hoverclosest', 'hovercompare', 'togglehover', 'sendDataToCloud', 'toggleSpikelines'] };
            Plotly.newPlot(chartDiv, plotData, layout, config);
        }

        /**
         * Renders the Choropleth Map.
         */
        function renderChoroplethMap(data, chartDiv) {
            const plotData = [{
                type: 'choropleth',
                locationmode: 'USA-states',
                locations: data.map(d => d.State),
                z: data.map(d => d.AvgCharges),
                colorscale: 'Blues',
                colorbar: {
                    title: {
                        text: 'Avg. Covered Charges ($)',
                        font: { color: '#e2e8f0' }
                    },
                    tickfont: { color: '#a0aec0' }
                },
                hovertemplate: `<b>%{location}</b><br>Avg. Covered Charges: %{z:$,.2f}<extra></extra>`,
            }];

            const layout = {
                title: {
                    text: 'Geographic Variation in Average Covered Charges',
                    font: { color: '#e2e8f0', family: 'Inter, sans-serif' }
                },
                geo: {
                    scope: 'usa',
                    bgcolor: '#2d3748',
                    lakecolor: '#4a5568',
                    landcolor: '#2d3748',
                    subunitcolor: '#6b7280',
                    countrycolor: '#6b7280',
                    showlakes: true,
                    showsubunits: true,
                    showcountries: true,
                },
                paper_bgcolor: '#2d3748',
                plot_bgcolor: '#2d3748',
                font: { color: '#e2e8f0', family: 'Inter, sans-serif' },
                hoverlabel: { bgcolor: '#4a5568', font: { color: '#e2e8f0' } }
            };

            const config = { responsive: true, displayModeBar: true, modeBarButtonsToRemove: ['zoom2d', 'pan2d', 'select2d', 'lasso2d', 'autoscale', 'resetscale', 'hoverclosest', 'hovercompare', 'togglehover', 'sendDataToCloud', 'toggleSpikelines'] };
            Plotly.newPlot(chartDiv, plotData, layout, config);
        }

        /**
         * Renders the Scatter Plot.
         */
        function renderScatterPlot(data, chartDiv) {
            const plotData = [];
            const colors = {
                'Circulatory System': '#3182ce', // Blue
                'Blood Diseases': '#38b2ac',     // Teal
                'Alcohol and Drug Use': '#f6ad55', // Orange
                'All': '#a0aec0' // Gray for 'All'
            };

            data.forEach(trace => {
                if (trace.regression_x) {
                    // This is a regression line trace
                    plotData.push({
                        x: trace.regression_x,
                        y: trace.regression_y,
                        mode: 'lines',
                        name: trace.classification,
                        line: { color: colors[trace.classification.replace(' (Regression)', '')] || '#a0aec0', width: 2, dash: 'dash' },
                        hoverinfo: 'none' // No hover for regression line
                    });
                } else {
                    // This is a scatter trace
                    plotData.push({
                        x: trace.charges,
                        y: trace.payments,
                        mode: 'markers',
                        name: trace.classification,
                        marker: {
                            color: colors[trace.classification] || '#a0aec0',
                            size: 8,
                            opacity: 0.7,
                            line: { color: '#2d3748', width: 1 }
                        },
                        hovertemplate: `Avg. Covered Charges: %{x:$,.2f}<br>Avg. Total Payments: %{y:$,.2f}<br>Classification: ${trace.classification}<extra></extra>`,
                    });
                }
            });

            const layout = {
                title: {
                    text: 'Average Total Payments vs. Average Covered Charges',
                    font: { color: '#e2e8f0', family: 'Inter, sans-serif' }
                },
                xaxis: {
                    title: 'Average Covered Charges ($)',
                    showgrid: true,
                    gridcolor: '#4a5568',
                    linecolor: '#6b7280',
                    tickfont: { color: '#a0aec0' },
                    titlefont: { color: '#e2e8f0' },
                    rangemode: 'tozero'
                },
                yaxis: {
                    title: 'Average Total Payments ($)',
                    showgrid: true,
                    gridcolor: '#4a5568',
                    linecolor: '#6b7280',
                    tickfont: { color: '#a0aec0' },
                    titlefont: { color: '#e2e8f0' },
                    rangemode: 'tozero'
                },
                paper_bgcolor: '#2d3748',
                plot_bgcolor: '#2d3748',
                font: { color: '#e2e8f0', family: 'Inter, sans-serif' },
                hoverlabel: { bgcolor: '#4a5568', font: { color: '#e2e8f0' } },
                legend: {
                    x: 0.01, y: 0.99,
                    bgcolor: '#2d3748',
                    bordercolor: '#4a5568',
                    borderwidth: 1,
                    font: { color: '#e2e8f0' }
                }
            };

            const config = { responsive: true, displayModeBar: true, modeBarButtonsToRemove: ['zoom2d', 'pan2d', 'select2d', 'lasso2d', 'autoscale', 'resetscale', 'hoverclosest', 'hovercompare', 'togglehover', 'sendDataToCloud', 'toggleSpikelines'] };
            Plotly.newPlot(chartDiv, plotData, layout, config);
        }

        /**
         * Renders the Treemap for Providers.
         */
        function renderProviderTreemap(data, chartDiv) {
            const labels = data.map(d => d.Label);
            const values = data.map(d => d['Total Discharges']);

            const chartTitle = `Total Discharges by Provider (Top ${topNProvidersSlider.value})`;

            const plotData = [{
                type: "treemap",
                labels: labels,
                parents: Array(labels.length).fill(""),
                values: values,
                marker: {
                    colorscale: 'Greens', // Different color scale for distinction
                    line: { width: 1, color: '#2d3748' }
                },
                textinfo: "label+value",
                hoverinfo: "text",
                hovertemplate: `<b>%{label}</b><br>Total Discharges: %{value}<extra></extra>`,
                pathbar: { visible: false },
            }];

            const layout = {
                title: {
                    text: chartTitle,
                    font: { color: '#e2e8f0', family: 'Inter, sans-serif' }
                },
                margin: { t: 50, l: 0, r: 0, b: 0 },
                paper_bgcolor: '#2d3748',
                plot_bgcolor: '#2d3748',
                font: { color: '#e2e8f0', family: 'Inter, sans-serif' },
                hoverlabel: { bgcolor: '#4a5568', font: { color: '#e2e8f0' } }
            };

            const config = { responsive: true, displayModeBar: true, modeBarButtonsToRemove: ['zoom2d', 'pan2d', 'select2d', 'lasso2d', 'autoscale', 'resetscale', 'hoverclosest', 'hovercompare', 'togglehover', 'sendDataToCloud', 'toggleSpikelines'] };
            Plotly.newPlot(chartDiv, plotData, layout, config);
        }

        /**
         * Renders the Histogram for Reimbursement Rates.
         */
        function renderHistogram(data, chartDiv, params) {
            const plotData = [];
            const binWidth = params.bin_width;
            const colors = {
                'All': '#3182ce',
                'Circulatory System': '#3182ce',
                'Blood Diseases': '#38b2ac',
                'Alcohol and Drug Use': '#f6ad55'
            };

            for (const classification in data.data) {
                plotData.push({
                    x: data.data[classification],
                    type: 'histogram',
                    name: classification,
                    xbins: {
                        start: 0,
                        end: 1.87, // Max reimbursement rate from prompt
                        size: binWidth
                    },
                    marker: {
                        color: colors[classification],
                        line: { color: '#2d3748', width: 1 }
                    },
                    opacity: 0.7,
                    histnorm: 'count', // Can be 'probability', 'density', etc.
                    hovertemplate: `Range: %{x}<br>Count: %{y}<extra></extra>`,
                });
            }

            const layout = {
                title: {
                    text: 'Distribution of Reimbursement Rates',
                    font: { color: '#e2e8f0', family: 'Inter, sans-serif' }
                },
                xaxis: {
                    title: 'Reimbursement Rate',
                    showgrid: true,
                    gridcolor: '#4a5568',
                    linecolor: '#6b7280',
                    tickfont: { color: '#a0aec0' },
                    titlefont: { color: '#e2e8f0' },
                    range: [0, 1.87] // Match max from prompt
                },
                yaxis: {
                    title: 'Count',
                    showgrid: true,
                    gridcolor: '#4a5568',
                    linecolor: '#6b7280',
                    tickfont: { color: '#a0aec0' },
                    titlefont: { color: '#e2e8f0' }
                },
                barmode: (Object.keys(data.data).length > 1) ? 'overlay' : 'group', // Overlay if segmented
                paper_bgcolor: '#2d3748',
                plot_bgcolor: '#2d3748',
                font: { color: '#e2e8f0', family: 'Inter, sans-serif' },
                hoverlabel: { bgcolor: '#4a5568', font: { color: '#e2e8f0' } },
                legend: {
                    x: 0.01, y: 0.99,
                    bgcolor: '#2d3748',
                    bordercolor: '#4a5568',
                    borderwidth: 1,
                    font: { color: '#e2e8f0' }
                }
            };

            const config = { responsive: true, displayModeBar: true, modeBarButtonsToRemove: ['zoom2d', 'pan2d', 'select2d', 'lasso2d', 'autoscale', 'resetscale', 'hoverclosest', 'hovercompare', 'togglehover', 'sendDataToCloud', 'toggleSpikelines'] };
            Plotly.newPlot(chartDiv, plotData, layout, config);
        }

        // --- Update All Charts Function ---
        async function updateAllCharts() {
            // Update Treemap (Medical Definition)
            await fetchDataAndRenderChart(
                '/api/treemap_data',
                treemapChartDiv,
                renderMedicalDefinitionTreemap,
                {
                    group_by_treemap: document.querySelector('input[name="group-by-treemap"]:checked').value,
                    classification: treemapClassificationFilter.value
                }
            );

            // Update Bar Chart (Reimbursement Rate)
            await fetchDataAndRenderChart(
                '/api/reimbursement_bar_data',
                barChartDiv,
                renderReimbursementBarChart,
                {
                    bar_chart_definition: barChartDefinitionFilter.value,
                    bar_chart_sort: document.querySelector('input[name="bar-chart-sort"]:checked').value
                }
            );

            // Update Choropleth Map
            await fetchDataAndRenderChart(
                '/api/choropleth_data',
                choroplethChartDiv,
                renderChoroplethMap,
                {
                    classification: choroplethClassificationFilter.value,
                    definition: choroplethDefinitionFilter.value
                }
            );

            // Update Scatter Plot
            await fetchDataAndRenderChart(
                '/api/scatter_data',
                scatterChartDiv,
                renderScatterPlot,
                {
                    color_by_classification: document.querySelector('input[name="scatter-color-by"]:checked').value,
                    show_regression: showRegressionToggle.checked
                }
            );

            // Update Provider Treemap
            topNProvidersDisplay.textContent = topNProvidersSlider.value; // Update slider display
            await fetchDataAndRenderChart(
                '/api/provider_treemap_data',
                providerTreemapChartDiv,
                renderProviderTreemap,
                {
                    provider_treemap_state: providerTreemapStateFilter.value,
                    top_n_providers: topNProvidersSlider.value
                }
            );

            // Update Histogram
            binWidthDisplay.textContent = binWidthSlider.value; // Update slider display
            await fetchDataAndRenderChart(
                '/api/histogram_data',
                histogramChartDiv,
                renderHistogram,
                {
                    bin_width: binWidthSlider.value,
                    segment_by_classification: document.querySelector('input[name="histogram-segment-by"]:checked').value
                }
            );

            // Update global filter displays
            reimbursementRateDisplay.textContent = `${parseFloat(filterReimbursementRateMin.value).toFixed(2)} - ${parseFloat(filterReimbursementRateMax.value).toFixed(2)}`;
            chargesDisplay.textContent = `$${parseInt(filterChargesMin.value).toLocaleString()} - $${parseInt(filterChargesMax.value).toLocaleString()}`;
            dischargesDisplay.textContent = `${parseInt(filterDischargesMin.value).toLocaleString()} - ${parseInt(filterDischargesMax.value).toLocaleString()}`;
        }


        // --- Event Listeners for All Filters and Controls ---
        document.addEventListener('DOMContentLoaded', function() {
            // Global Filters
            filterClassification.addEventListener('change', updateAllCharts);
            filterDefinition.addEventListener('change', updateAllCharts);
            filterDrgCode.addEventListener('change', updateAllCharts);
            filterProviderState.addEventListener('change', updateAllCharts);
            filterHospitalRegion.addEventListener('change', updateAllCharts);

            filterReimbursementRateMin.addEventListener('input', updateAllCharts);
            filterReimbursementRateMax.addEventListener('input', updateAllCharts);
            filterChargesMin.addEventListener('input', updateAllCharts);
            filterChargesMax.addEventListener('input', updateAllCharts);
            filterDischargesMin.addEventListener('input', updateAllCharts);
            filterDischargesMax.addEventListener('input', updateAllCharts);

            // Treemap (Medical Definition) controls
            treemapClassificationFilter.addEventListener('change', updateAllCharts);
            groupByTreemapRadios.forEach(radio => radio.addEventListener('change', updateAllCharts));

            // Bar Chart controls
            barChartDefinitionFilter.addEventListener('change', updateAllCharts);
            barChartSortRadios.forEach(radio => radio.addEventListener('change', updateAllCharts));

            // Choropleth controls
            choroplethClassificationFilter.addEventListener('change', updateAllCharts);
            choroplethDefinitionFilter.addEventListener('change', updateAllCharts);

            // Scatter Plot controls
            scatterColorByRadios.forEach(radio => radio.addEventListener('change', updateAllCharts));
            showRegressionToggle.addEventListener('change', updateAllCharts);

            // Provider Treemap controls
            providerTreemapStateFilter.addEventListener('change', updateAllCharts);
            topNProvidersSlider.addEventListener('input', updateAllCharts); // 'input' for continuous update

            // Histogram controls
            binWidthSlider.addEventListener('input', updateAllCharts); // 'input' for continuous update
            histogramSegmentByRadios.forEach(radio => radio.addEventListener('change', updateAllCharts));


            // Initial render of all charts and filter displays
            updateAllCharts();

            // Adjust chart size on window resize for responsiveness
            window.addEventListener('resize', () => {
                Plotly.relayout(treemapChartDiv, { width: treemapChartDiv.clientWidth, height: treemapChartDiv.clientHeight });
                Plotly.relayout(barChartDiv, { width: barChartDiv.clientWidth, height: barChartDiv.clientHeight });
                Plotly.relayout(choroplethChartDiv, { width: choroplethChartDiv.clientWidth, height: choroplethChartDiv.clientHeight });
                Plotly.relayout(scatterChartDiv, { width: scatterChartDiv.clientWidth, height: scatterChartDiv.clientHeight });
                Plotly.relayout(providerTreemapChartDiv, { width: providerTreemapChartDiv.clientWidth, height: providerTreemapChartDiv.clientHeight });
                Plotly.relayout(histogramChartDiv, { width: histogramChartDiv.clientWidth, height: histogramChartDiv.clientHeight });
            });
        });
    </script>
</body>
</html>
